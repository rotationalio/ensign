<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Ensign for Application Developers # Hi there! This tutorial is targeted towards Golang application developers. If you are interested in or currently writing event-driven applications in Go you are in the right place! In this code-driven tutorial we will use the Ensign Golang SDK to publish curated tweets to an event stream and retrieve them in real time.
If you came here for the code the full example is available here."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Ensign for Application Developers"><meta property="og:description" content="Ensign for Application Developers # Hi there! This tutorial is targeted towards Golang application developers. If you are interested in or currently writing event-driven applications in Go you are in the right place! In this code-driven tutorial we will use the Ensign Golang SDK to publish curated tweets to an event stream and retrieve them in real time.
If you came here for the code the full example is available here."><meta property="og:type" content="article"><meta property="og:url" content="https://ensign.rotational.dev/examples/developers/"><meta property="article:section" content="examples"><meta property="article:modified_time" content="2023-01-29T09:27:31-06:00"><title>Ensign for Application Developers | Ensign Docs</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.57f59bed6677922e9441fc41df4da3dc906a45058f7c8af184aaf40f7b30f971.css integrity="sha256-V/Wb7WZ3ki6UQfxB302j3JBqRQWPfIrxhKr0D3sw+XE=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.10a7743f2493dc311aaec75d582dedf003700e858da102ead7f567a2a919a11f.js integrity="sha256-EKd0PyST3DEarsddWC3t8ANwDoWNoQLq1/VnoqkZoR8=" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XMWR6VW3VJ"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XMWR6VW3VJ",{anonymize_ip:!1})}</script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><img src=/logo.png alt=Logo><span>Ensign Docs</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/getting-started/>Getting Started</a><ul></ul></li><li><a href=/examples/>End-to-End Examples</a><ul><li><a href=/examples/developers/ class=active>Ensign for Application Developers</a></li><li><a href=/examples/data_engineers/>Ensign for Data Engineers</a></li></ul></li><li><a href=/eventing/>Eventing 101</a><ul></ul></li><li><a href=/sdk/>SDKs</a><ul></ul></li><li><a href=/system/>System</a><ul><li><a href=/system/configuration/>Configuration</a></li></ul></li></ul><ul><li><a href=https://github.com/rotationalio/ensign target=_blank rel=noopener>GitHub</a></li><li><a href=https://rotational.io target=_blank rel=noopener>Rotational Labs</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Ensign for Application Developers</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#ensign-for-application-developers>Ensign for Application Developers</a><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#project-setup>Project Setup</a></li><li><a href=#sourcing-tweets>Sourcing Tweets</a></li><li><a href=#creating-a-publisher>Creating a Publisher</a></li><li><a href=#publishing-events>Publishing Events</a></li><li><a href=#creating-a-subscriber>Creating a subscriber</a></li><li><a href=#what-next>What Next?</a><ul><li><a href=#event-schemas>Event Schemas</a></li><li><a href=#additional-topic-streams>Additional Topic Streams</a></li><li><a href=#downstream-processing>Downstream Processing</a></li></ul></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=ensign-for-application-developers>Ensign for Application Developers
<a class=anchor href=#ensign-for-application-developers>#</a></h1><p>Hi there! This tutorial is targeted towards Golang application developers. If you are interested in or currently writing event-driven applications in Go you are in the right place! In this code-driven tutorial we will use the Ensign Golang SDK to publish curated tweets to an event stream and retrieve them in real time.</p><p>If you came here for the code the full example is available <a href=https://github.com/rotationalio/ensign-examples/tree/main/go/tweets>here</a>.</p><h2 id=prerequisites>Prerequisites
<a class=anchor href=#prerequisites>#</a></h2><p>To follow along with this tutorial you&rsquo;ll need to:</p><ul><li><a href=https://ensign.rotational.dev/getting-started/#getting-started>Generate an API key to access Ensign</a></li><li><a href=https://developer.twitter.com/en/docs/twitter-api/getting-started/getting-access-to-the-twitter-api>Set up a developer account with Twitter (it&rsquo;s free)</a></li><li><a href=https://help.twitter.com/en/managing-your-account/how-to-add-a-phone-number-to-your-account>Add a phone number to your Twitter developer account</a></li><li><a href=https://go.dev/doc/gopath_code>Set up your GOPATH and workspace</a></li></ul><h2 id=project-setup>Project Setup
<a class=anchor href=#project-setup>#</a></h2><p>The first thing we need to do is setup an environment to run our code. Let&rsquo;s create a blank module with a suitable name for our project:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ mkdir tweets
</span></span><span style=display:flex><span>$ go mod init github.com/rotationalio/ensign-examples/go/tweets
</span></span></code></pre></div><p>Next we&rsquo;ll need to install the Go SDK client and its dependencies from the GitHub <a href=https://github.com/rotationalio/ensign>repo</a>. In this tutorial we also use the <a href=https://github.com/g8rswimmer/go-twitter>go-twitter</a> client to interact with the twitter API (although you can also create the requests yourself)!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ go get -u github.com/rotationalio/ensign/sdks/go@latest
</span></span><span style=display:flex><span>$ go get -u github.com/g8rswimmer/go-twitter/v2@latest
</span></span></code></pre></div><p>Our project needs a <a href=https://ensign.rotational.dev/eventing/#publisher>publisher</a> to write events to Ensign and a <a href=https://ensign.rotational.dev/eventing/#subscriber>subscriber</a> to read those events (asynchronously). In a real application these would most likely be independent microservices that run in different execution contexts (e.g. containers in a k8s cluster or even across different regions). Let&rsquo;s create separate packages for the two command line applications as well as a shared package for our event schemas.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ mkdir publish
</span></span><span style=display:flex><span>$ mkdir subscribe
</span></span><span style=display:flex><span>$ mkdir schemas
</span></span></code></pre></div><h2 id=sourcing-tweets>Sourcing Tweets
<a class=anchor href=#sourcing-tweets>#</a></h2><p>In event-driven systems, events are the main unit of data. In production applications events might be sourced from user actions, IoT devices, webhooks, or act as control signals between microservices.</p><p>For this example our data source is curated tweets from twitter. Create a file called <code>main.go</code> in the <code>publish</code> directory and add the following code to it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;flag&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;context&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>twitter</span> <span style=color:#e6db74>&#34;github.com/g8rswimmer/go-twitter/v2&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>authorize</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Token</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>a</span> <span style=color:#a6e22e>authorize</span>) <span style=color:#a6e22e>Add</span>(<span style=color:#a6e22e>req</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>Header</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#e6db74>&#34;Authorization&#34;</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;Bearer %s&#34;</span>, <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>Token</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> (
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>err</span>   <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>token</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>token</span> = <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Getenv</span>(<span style=color:#e6db74>&#34;TWITTER_API_BEARER_TOKEN&#34;</span>); <span style=color:#a6e22e>token</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>		panic(<span style=color:#e6db74>&#34;TWITTER_API_BEARER_TOKEN environment variable is required&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>query</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>String</span>(<span style=color:#e6db74>&#34;query&#34;</span>, <span style=color:#e6db74>&#34;distributed systems&#34;</span>, <span style=color:#e6db74>&#34;Twitter search query&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>Parse</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>tweets</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>twitter</span>.<span style=color:#a6e22e>Client</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Authorizer</span>: <span style=color:#a6e22e>authorize</span>{
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Token</span>: <span style=color:#f92672>*</span><span style=color:#a6e22e>token</span>,
</span></span><span style=display:flex><span>		},
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Client</span>: <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>DefaultClient</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Host</span>:   <span style=color:#e6db74>&#34;https://api.twitter.com&#34;</span>,
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>cancel</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>WithTimeout</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>(), <span style=color:#ae81ff>30</span><span style=color:#f92672>*</span><span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>cancel</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>rep</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>tweets</span>.<span style=color:#a6e22e>TweetRecentSearchResponse</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>rep</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>TweetRecentSearch</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>query</span>, <span style=color:#a6e22e>twitter</span>.<span style=color:#a6e22e>TweetRecentSearchOpts</span>{}); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>errs</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>rep</span>.<span style=color:#a6e22e>Raw</span>.<span style=color:#a6e22e>Errors</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Error: %s\n&#34;</span>, <span style=color:#a6e22e>errs</span>.<span style=color:#a6e22e>Detail</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>tweet</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>rep</span>.<span style=color:#a6e22e>Raw</span>.<span style=color:#a6e22e>Tweets</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%s: %s\n&#34;</span>, <span style=color:#a6e22e>tweet</span>.<span style=color:#a6e22e>AuthorID</span>, <span style=color:#a6e22e>tweet</span>.<span style=color:#a6e22e>Text</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This is a simple command line application that will retrieve a single page of search results from twitter and print them out. Feel free to build the program and run it with any search query to make sure it works!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ export TWITTER_API_BEARER_TOKEN<span style=color:#f92672>=</span><span style=color:#75715e># Your Twitter API bearer token goes here</span>
</span></span><span style=display:flex><span>$ cd publish
</span></span><span style=display:flex><span>$ go build -o publish main.go
</span></span><span style=display:flex><span>$ ./publish --query <span style=color:#e6db74>&#34;distributed systems&#34;</span>
</span></span></code></pre></div><h2 id=creating-a-publisher>Creating a Publisher
<a class=anchor href=#creating-a-publisher>#</a></h2><p>Now that we have a data source, the next step is to create an Ensign client using the Client ID and Client Secret pair you received when <a href=https://ensign.rotational.dev/getting-started/#getting-started>generating your API key</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>twitter</span> <span style=color:#e6db74>&#34;github.com/g8rswimmer/go-twitter/v2&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ensign</span> <span style=color:#e6db74>&#34;github.com/rotationalio/ensign/sdks/go&#34;</span>
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> (
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>err</span>   <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>token</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>token</span> = <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Getenv</span>(<span style=color:#e6db74>&#34;TWITTER_API_BEARER_TOKEN&#34;</span>); <span style=color:#a6e22e>token</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>		panic(<span style=color:#e6db74>&#34;TWITTER_API_BEARER_TOKEN environment variable is required&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>query</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>String</span>(<span style=color:#e6db74>&#34;query&#34;</span>, <span style=color:#e6db74>&#34;distributed systems&#34;</span>, <span style=color:#e6db74>&#34;Twitter search query&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>Parse</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// ENSIGN_CLIENT_ID and ENSIGN_CLIENT_SECRET environment variables must be set
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>client</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>ensign</span>.<span style=color:#a6e22e>Client</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>client</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>ensign</span>.<span style=color:#a6e22e>New</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>ensign</span>.<span style=color:#a6e22e>Options</span>{}); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		panic(<span style=color:#e6db74>&#34;failed to create Ensign client: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>())
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span></code></pre></div><p>In the Go SDK, creating a <code>Publisher</code> interface from the client is straightforward.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>pub</span> <span style=color:#a6e22e>ensign</span>.<span style=color:#a6e22e>Publisher</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>pub</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>Publish</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>()); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		panic(<span style=color:#e6db74>&#34;failed to create publisher from Ensign client: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>())
</span></span><span style=display:flex><span>	}
</span></span></code></pre></div><h2 id=publishing-events>Publishing Events
<a class=anchor href=#publishing-events>#</a></h2><p>In Ensign, events include a lot more than the data itself. As we can see from the <a href=https://github.com/rotationalio/ensign/blob/main/pkg/api/v1beta1/event.pb.go>protocol buffer</a>, events are self-descriptive and are quite flexible.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Event</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>state</span>         <span style=color:#a6e22e>protoimpl</span>.<span style=color:#a6e22e>MessageState</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>sizeCache</span>     <span style=color:#a6e22e>protoimpl</span>.<span style=color:#a6e22e>SizeCache</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>unknownFields</span> <span style=color:#a6e22e>protoimpl</span>.<span style=color:#a6e22e>UnknownFields</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Id</span>            <span style=color:#66d9ef>string</span>                 <span style=color:#e6db74>`protobuf:&#34;bytes,1,opt,name=id,proto3&#34; json:&#34;id,omitempty&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>TopicId</span>       <span style=color:#66d9ef>string</span>                 <span style=color:#e6db74>`protobuf:&#34;bytes,2,opt,name=topic_id,json=topicId,proto3&#34; json:&#34;topic_id,omitempty&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Mimetype</span>      <span style=color:#a6e22e>v1beta1</span>.<span style=color:#a6e22e>MIME</span>           <span style=color:#e6db74>`protobuf:&#34;varint,3,opt,name=mimetype,proto3,enum=mimetype.v1beta1.MIME&#34; json:&#34;mimetype,omitempty&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Type</span>          <span style=color:#f92672>*</span><span style=color:#a6e22e>Type</span>                  <span style=color:#e6db74>`protobuf:&#34;bytes,4,opt,name=type,proto3&#34; json:&#34;type,omitempty&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Key</span>           []<span style=color:#66d9ef>byte</span>                 <span style=color:#e6db74>`protobuf:&#34;bytes,5,opt,name=key,proto3&#34; json:&#34;key,omitempty&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Data</span>          []<span style=color:#66d9ef>byte</span>                 <span style=color:#e6db74>`protobuf:&#34;bytes,6,opt,name=data,proto3&#34; json:&#34;data,omitempty&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Encryption</span>    <span style=color:#f92672>*</span><span style=color:#a6e22e>Encryption</span>            <span style=color:#e6db74>`protobuf:&#34;bytes,7,opt,name=encryption,proto3&#34; json:&#34;encryption,omitempty&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Compression</span>   <span style=color:#f92672>*</span><span style=color:#a6e22e>Compression</span>           <span style=color:#e6db74>`protobuf:&#34;bytes,8,opt,name=compression,proto3&#34; json:&#34;compression,omitempty&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Geography</span>     <span style=color:#f92672>*</span><span style=color:#a6e22e>Region</span>                <span style=color:#e6db74>`protobuf:&#34;bytes,9,opt,name=geography,proto3&#34; json:&#34;geography,omitempty&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Publisher</span>     <span style=color:#f92672>*</span><span style=color:#a6e22e>Publisher</span>             <span style=color:#e6db74>`protobuf:&#34;bytes,10,opt,name=publisher,proto3&#34; json:&#34;publisher,omitempty&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>UserDefinedId</span> <span style=color:#66d9ef>string</span>                 <span style=color:#e6db74>`protobuf:&#34;bytes,11,opt,name=user_defined_id,json=userDefinedId,proto3&#34; json:&#34;user_defined_id,omitempty&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Created</span>       <span style=color:#f92672>*</span><span style=color:#a6e22e>timestamppb</span>.<span style=color:#a6e22e>Timestamp</span> <span style=color:#e6db74>`protobuf:&#34;bytes,14,opt,name=created,proto3&#34; json:&#34;created,omitempty&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Committed</span>     <span style=color:#f92672>*</span><span style=color:#a6e22e>timestamppb</span>.<span style=color:#a6e22e>Timestamp</span> <span style=color:#e6db74>`protobuf:&#34;bytes,15,opt,name=committed,proto3&#34; json:&#34;committed,omitempty&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>For this tutorial we are mostly concerned with the following fields.</p><ul><li><code>TopicId</code>: Events are organized into <a href=%28https://ensign.rotational.dev/eventing/#topic%29>topics</a> and events in a topic usually follow a similar schema</li><li><code>Mimetype</code>: In Ensign all event data is generic &ldquo;blob&rdquo; data to allow for heterogenous event streams. The mimetype allows subcribers to deserialize data back into an understandable format.</li><li><code>Type</code>: Events in Ensign are tagged with schema type and versioning info to allow publishers and subscribers to lookup schemas in a shared registry. This is important because certain serialization methods (e.g. protobuf, parquet) require explicit schemas for deserialization and schema-less methods (e.g. JSON) can be enhanced with versioning.</li></ul><p>In this example we can get away with structured JSON. In production worfklows we would most likely want to store the definition in a schema registry but for now let&rsquo;s add it to <code>tweets.go</code> in the <code>schemas</code> directory so both our producer and subscriber can access it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>schemas</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Tweet</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Author</span>    <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;author&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Text</span>      <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;text&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>CreatedAt</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;created_at&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Now that we know how to serialize JSON, in the tweet loop instead of printing to the console let&rsquo;s go ahead and publish some events.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>tweet</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>rep</span>.<span style=color:#a6e22e>Raw</span>.<span style=color:#a6e22e>Tweets</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>e</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>Event</span>{
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>TopicId</span>:  <span style=color:#e6db74>&#34;tweets&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Mimetype</span>: <span style=color:#a6e22e>mimetype</span>.<span style=color:#a6e22e>ApplicationJSON</span>,
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Type</span>: <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>Type</span>{
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>Name</span>:    <span style=color:#e6db74>&#34;tweet&#34;</span>,
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>Version</span>: <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>			},
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>tweetObj</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>schemas</span>.<span style=color:#a6e22e>Tweet</span>{
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Author</span>:    <span style=color:#a6e22e>tweet</span>.<span style=color:#a6e22e>AuthorID</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Text</span>:      <span style=color:#a6e22e>tweet</span>.<span style=color:#a6e22e>Text</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>CreatedAt</span>: <span style=color:#a6e22e>tweet</span>.<span style=color:#a6e22e>CreatedAt</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Data</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Marshal</span>(<span style=color:#a6e22e>tweetObj</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			panic(<span style=color:#e6db74>&#34;could not marshal tweet to JSON: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>())
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Publish the event to Ensign
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#a6e22e>pub</span>.<span style=color:#a6e22e>Publish</span>(<span style=color:#a6e22e>e</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Check for errors
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>pub</span>.<span style=color:#a6e22e>Err</span>(); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			panic(<span style=color:#e6db74>&#34;failed to publish event(s): &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>())
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span></code></pre></div><p>If your IDE did not resolve the imports for you, you will need to specify them manually:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>api</span> <span style=color:#e6db74>&#34;github.com/rotationalio/ensign/pkg/api/v1beta1&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mimetype</span> <span style=color:#e6db74>&#34;github.com/rotationalio/ensign/pkg/mimetype/v1beta1&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p><em>Note that <code>pub.Publish(e)</code> does not return an immediate error, it&rsquo;s an asynchronous operation so if we want to check for errors we have to do so after the fact. This means that we can&rsquo;t be sure which event actually triggered the error.</em></p><p>Finally, to make our publisher feel like a real service, we can add an outer loop with a ticker so that the program periodically pulls the most recent tweets our search query of choice. Another useful improvement might be to utilize the <code>SinceID</code> on the twitter search options so that we aren&rsquo;t producing duplicate tweets!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span>	<span style=color:#a6e22e>ticker</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>NewTicker</span>(<span style=color:#ae81ff>10</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>sinceID</span> <span style=color:#f92672>:=</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>cancel</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>WithTimeout</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>(), <span style=color:#ae81ff>30</span><span style=color:#f92672>*</span><span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>cancel</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Done</span>():
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ticker</span>.<span style=color:#a6e22e>C</span>:
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;searching for tweets...&#34;</span>)
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>opts</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>twitter</span>.<span style=color:#a6e22e>TweetRecentSearchOpts</span>{
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>SortOrder</span>: <span style=color:#a6e22e>twitter</span>.<span style=color:#a6e22e>TweetSearchSortOrderRecency</span>,
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>SinceID</span>:   <span style=color:#a6e22e>sinceID</span>,
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>rep</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>twitter</span>.<span style=color:#a6e22e>TweetRecentSearchResponse</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>rep</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>tweets</span>.<span style=color:#a6e22e>TweetRecentSearch</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>query</span>, <span style=color:#a6e22e>opts</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>				panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>errs</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>rep</span>.<span style=color:#a6e22e>Raw</span>.<span style=color:#a6e22e>Errors</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Error: %s\n&#34;</span>, <span style=color:#a6e22e>errs</span>.<span style=color:#a6e22e>Detail</span>)
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>tweet</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>rep</span>.<span style=color:#a6e22e>Raw</span>.<span style=color:#a6e22e>Tweets</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>e</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>Event</span>{
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>TopicId</span>:  <span style=color:#e6db74>&#34;tweets&#34;</span>,
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>Mimetype</span>: <span style=color:#a6e22e>mimetype</span>.<span style=color:#a6e22e>ApplicationJSON</span>,
</span></span><span style=display:flex><span>					<span style=color:#a6e22e>Type</span>: <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>Type</span>{
</span></span><span style=display:flex><span>						<span style=color:#a6e22e>Name</span>:    <span style=color:#e6db74>&#34;Generic&#34;</span>,
</span></span><span style=display:flex><span>						<span style=color:#a6e22e>Version</span>: <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>					},
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Data</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Marshal</span>(<span style=color:#a6e22e>tweet</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>					panic(<span style=color:#e6db74>&#34;could not marshal tweet to JSON: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>())
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>pub</span>.<span style=color:#a6e22e>Publish</span>(<span style=color:#a6e22e>e</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>pub</span>.<span style=color:#a6e22e>Err</span>(); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>					panic(<span style=color:#e6db74>&#34;failed to publish event(s): &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>())
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;published tweet with ID: %s\n&#34;</span>, <span style=color:#a6e22e>tweet</span>.<span style=color:#a6e22e>ID</span>)
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>rep</span>.<span style=color:#a6e22e>Raw</span>.<span style=color:#a6e22e>Tweets</span>) &gt; <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>sinceID</span> = <span style=color:#a6e22e>rep</span>.<span style=color:#a6e22e>Raw</span>.<span style=color:#a6e22e>Tweets</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>ID</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span></code></pre></div><p>At this point our publisher will be able to request some new tweets from Twitter every 10 seconds and publish them as events to the <code>tweets</code> topic. Go ahead and try it out!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ export ENSIGN_CLIENT_ID<span style=color:#f92672>=</span><span style=color:#75715e># Your Ensign Client ID goes here</span>
</span></span><span style=display:flex><span>$ export ENSIGN_CLIENT_SECRET<span style=color:#f92672>=</span><span style=color:#75715e># Your Ensign Client Secret goes here</span>
</span></span><span style=display:flex><span>$ go build -o publish main.go
</span></span><span style=display:flex><span>$ ./publish --query <span style=color:#e6db74>&#34;otters&#34;</span>
</span></span></code></pre></div><p><em>Note: Here the Ensign Client ID and Client Secret are retrieved from environment variables but it&rsquo;s also possible to specify them in <a href=https://ensign.rotational.dev/getting-started/#create-a-client>code</a></em></p><h2 id=creating-a-subscriber>Creating a subscriber
<a class=anchor href=#creating-a-subscriber>#</a></h2><p>Similarly to the <code>Publisher</code>, a <code>Subscriber</code> interface can be created from an Ensign client. Once created, the <code>Subscriber</code> allows us to read events directly from a Go channel. Create a <code>main.go</code> in the <code>subscribe</code> directory and add the following code to it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;context&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;encoding/json&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;github.com/rotationalio/ensign-examples/go/tweets/schemas&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>api</span> <span style=color:#e6db74>&#34;github.com/rotationalio/ensign/pkg/api/v1beta1&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ensign</span> <span style=color:#e6db74>&#34;github.com/rotationalio/ensign/sdks/go&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> (
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>err</span>    <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>client</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>ensign</span>.<span style=color:#a6e22e>Client</span>
</span></span><span style=display:flex><span>	)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// ENSIGN_CLIENT_ID and ENSIGN_CLIENT_SECRET environment variables must be set
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>client</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>ensign</span>.<span style=color:#a6e22e>New</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>ensign</span>.<span style=color:#a6e22e>Options</span>{}); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		panic(<span style=color:#e6db74>&#34;failed to create Ensign client: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>())
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Create a subscriber from the client
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>sub</span> <span style=color:#a6e22e>ensign</span>.<span style=color:#a6e22e>Subscriber</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>sub</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>Subscribe</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>()); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		panic(<span style=color:#e6db74>&#34;failed to create subscriber from client: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>())
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>sub</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Create the event stream as a channel
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>events</span> <span style=color:#f92672>&lt;-</span><span style=color:#66d9ef>chan</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>Event</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>events</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>sub</span>.<span style=color:#a6e22e>Subscribe</span>(); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		panic(<span style=color:#e6db74>&#34;failed to create subscribe stream: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>())
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Events are processed as they show up on the channel
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>event</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>events</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>tweet</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>schemas</span>.<span style=color:#a6e22e>Tweet</span>{}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>(<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>Data</span>, <span style=color:#a6e22e>tweet</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			panic(<span style=color:#e6db74>&#34;failed to unmarshal event: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>())
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;received tweet %s\n&#34;</span>, <span style=color:#a6e22e>tweet</span>.<span style=color:#a6e22e>ID</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>tweet</span>.<span style=color:#a6e22e>Text</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>()
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>At this point you should be able to build and the run the subscriber in a second command window to retrieve tweet events in real time!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ export ENSIGN_CLIENT_ID<span style=color:#f92672>=</span><span style=color:#75715e># Your Ensign Client ID</span>
</span></span><span style=display:flex><span>$ export ENSIGN_CLIENT_SECRET<span style=color:#f92672>=</span><span style=color:#75715e># Your Ensign Client Secret</span>
</span></span><span style=display:flex><span>$ cd subscribe
</span></span><span style=display:flex><span>$ go build -o subscribe main.go
</span></span><span style=display:flex><span>$ ./subscribe
</span></span></code></pre></div><h2 id=what-next>What Next?
<a class=anchor href=#what-next>#</a></h2><p>Hopefully this gets you on the right track and inspires some ideas for event-driven applications. If this example were to become a real application, here are some things we might consider.</p><h3 id=event-schemas>Event Schemas
<a class=anchor href=#event-schemas>#</a></h3><p>Remember that an Ensign event encodes a lot of metadata. When dealing with more strutured or versioned serialization formats such as protobuf, we definitely want to consider adding some logic to the subscriber to lookup the event schema in the schema registry or a local cache with the <code>event.Type</code> field.</p><h3 id=additional-topic-streams>Additional Topic Streams
<a class=anchor href=#additional-topic-streams>#</a></h3><p>With Ensign it&rsquo;s easy to scale up by adding new topics. We might want to have different topics for error observability (e.g. if the Twitter API changes or schemas unexpectedly change), metrics capturing, or different types of Twitter queries.</p><h3 id=downstream-processing>Downstream Processing
<a class=anchor href=#downstream-processing>#</a></h3><p>Once we have an event stream, what do we do with it? A traditional approach is to capture data into a database for persistence and to make it easy to materialize data views for application users. This is certainly possible with Ensign. However, Ensign also offers persistence of event streams, which makes it possible to perform historical queries on the streams themselves.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/rotationalio/ensign/commit/2fe870a9aa2d0b1fc3ee5a2a78eeb8dda20d8754 title='Last modified by Patrick Deziel | Jan 29, 2023' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>Jan 29, 2023</span></a></div><div><a class="flex align-center" href=https://github.com/rotationalio/ensign/edit/main/docs/content/examples/developers.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#ensign-for-application-developers>Ensign for Application Developers</a><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#project-setup>Project Setup</a></li><li><a href=#sourcing-tweets>Sourcing Tweets</a></li><li><a href=#creating-a-publisher>Creating a Publisher</a></li><li><a href=#publishing-events>Publishing Events</a></li><li><a href=#creating-a-subscriber>Creating a subscriber</a></li><li><a href=#what-next>What Next?</a><ul><li><a href=#event-schemas>Event Schemas</a></li><li><a href=#additional-topic-streams>Additional Topic Streams</a></li><li><a href=#downstream-processing>Downstream Processing</a></li></ul></li></ul></li></ul></nav></div></aside></main></body></html>